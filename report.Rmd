---
title: "Reallocating MTA Finances"
author: "Jessica Padilla"
date: "September 27, 2019"
output:
  pdf_document: default
---

## Introduction

The Metropolitan Transportation Authority (MTA) is responsible for overseeing the transportation network throughout New York City and its surrounding regions.  The MTA consists of New York City Transit, Long Island Railroad, Metro-North Railroad, Staten Island Railway, Regional Bus Operations, and B&T (Bridges and Tunnels).  For this project, we focus on the New York City Transit subways provided by the MTA.

In 1979, the subway system was completely deteoriated.  In order to revive the system, the MTA needed more funds than the State of New York could provide annually.  As a result, the MTA continuously sold bonds and took on several loans to rebuild infrastructure, in hopes that the debt would eventually be paid off by fare revenue.  However, many decades later, there is a decrease in subway ridership, and the MTA debt is approaching 42 billion dollars.  But why is subway ridership declining?  Is the MTA to blame, or are people looking to other forms of transportation?

In 2013, a bike share program called Citi Bike was launched throughout NYC.  Citi Bike allows people to borrow bikes and pay either on an hourly basis, daily basis, or through an annual membership.  Because it is eco-friendly in nature and very affordable, it has attracted thousands of people throughout the city.  Several years later after its launch, the number of Citi Bike users continues to increase and shows no sign of slowing down.

Here we discuss how the decrease in subway ridership is correlated to the increase in Citi Bike services.  We also provide suggestions on how MTA finances can be re-allocated to help subways remain competitive in the transporation industry.

&nbsp;

## Methods

Annual and average subway ridership totals were retrieved from the MTA web site (http://web.mta.info/nyct/facts/ridership/) through web scraping.  This involved extracting text and tables from the html code within the web page and converting them into data tables.  A breakdown of subway ridership at each station was also retrieved from the MTA web site (http://web.mta.info/nyct/facts/ridership/ridership_sub_annual.htm) through web scraping.

Information in regards to MTA subway service was obtained through the "Performance Dashboard" of the MTA web site (http://dashboard.mta.info).  Data was exported into 4 .csv files.

MTA budget and revenue data were found on the "MTA Fiscal Dashboard" of the Citizens Budget Commission web site (https://cbcny.org/research/mta-fiscal-dashboard).  Data was exported from the site into 3 .csv files. 

Citi Bike data was retrieved from the official Citi Bike web site (https://www.citibikenyc.com/system-data).  All quarterly data was exported into a total of 22 .csv files.

All of the data was, then, imported into R.  Data was filtered to only include information pertaining to the subway system and Citi Bikes.  It was also filtered up to and including the year 2018, since the year 2019 is not yet completed.  Wrangling was, then, performed to clean any relevant data and format it for further analysis.  After the data was cleaned, the subway and Citi Bike ridership data was merged into one table.  This was done through the use of the tidyverse package within R.

The ggplot2 package was used within R as the primary tool for data visualization techniques.  Graphs generated with this package were used to demonstrate trends and new findings.



## Results

The debt of the MTA has grown significantly over the years and is projected to reach $42 billion by the year 2022.  While fare revenue has been able to offset a bit of the debt, fare revenue has reached a standstill.  Data obtained from the MTA Fiscal Dashboard (Citizens Budget Commission) shows that although the fare revenue is much larger than what it was in 2007, the amount of fare revenue has slowed down since 2013.  In fact, there was a slight decrease in fare revenue in 2018.  This can be explained by the downward trend in subway ridership.

&nbsp;
```{r, subway fare revenue, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## load libraries
library(tidyverse)
library(rvest)
library(gridExtra)
library(lubridate)

## retrieve the mta revenue data
mta_revenue <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/mta_revenue.csv")

## check the structure of the mta revenue table
str(mta_revenue)

## remove unwanted columns and rename some columns
mta_revenue <- mta_revenue %>% select(-c("Fifty2525", "Date Prefix", 
                                         "Revenue Type Note", "Adjustments Outcome",
                                         "No-Adjustments Value", "Date",
                                         "Framework Selection Calculation")) %>%
  rename(business_line_group = 'Business Line (group)',
         business_line = 'Business Line',
         revenue_description = Description1,
         revenue_type = 'Revenue and Expense Type',
         year = Year,
         revenue_value = Value)

## change all NA values to 0
mta_revenue[is.na(mta_revenue)] = 0

## check the mta revenue table
head(mta_revenue)

## create a graph for subway fare revenue totals each year
## exclude year 2019 since the year is not yet completed
mta_revenue %>% filter(year <= 2018 & revenue_description == "Subway") %>%
  ggplot(aes(year, revenue_value)) + 
  geom_bar(stat = "identity", fill = "black") +
  scale_x_continuous(breaks = seq(2007, 2018, 1)) + 
  xlab("Year") + ylab("Total Revenue (millions)") +
  ggtitle("MTA Subway Fare Revenue") + 
  theme_bw()
```

```{r, annual subway totals, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## set the link for subway ridership totals
subway_totals_url <- "http://web.mta.info/nyct/facts/ridership/"

## get the html code
subway_totals_html <- read_html(subway_totals_url)

## get the tables from the html code
subway_totals_table <- subway_totals_html %>% html_nodes("table")

## find the table
subway_totals_table

## get the subway totals table
subway_totals_table[[2]]

## turn the table to a data frame
subway_totals <- subway_totals_table[[2]] %>% html_table

## check the structure of the subway ridership data
str(subway_totals)

## change the year column to numbers
subway_totals[,1] <- subway_totals[,1] %>% as.numeric()

## create a function to remove commas from a column and turn the column to numbers
numbers <- function(x){
  x <- str_replace_all(x, ",", "")
  x <- as.numeric(x)
}

## remove the commas from the remaining columns and convert them to numbers
subway_totals[,2:6] <- lapply(subway_totals[,(2:6)], numbers)

## convert the data to a tibble
subway_totals <- subway_totals %>% as_tibble()

## rename the columns
subway_totals <- subway_totals %>% 
  rename(year = Year,
         average_weekdays = `Average Weekday`,
         average_saturdays = `Average Saturday`,
         average_sundays = `Average Sunday`,
         average_weekends = `Average Weekend`,
         annual_total = `Annual Total`)

## check the table
head(subway_totals)

## create a graph showing the annual number of subway riders
subway_totals %>% 
  ggplot(aes(year, annual_total)) + 
  geom_point(color = "purple", show.legend = FALSE) + 
  geom_line(color = "purple", show.legend = FALSE) + 
  coord_cartesian(ylim = c(1650000000, 1800000000)) +
  xlab("Year") + ylab("Total Number of Riders") + 
  ggtitle("Annual Subway Ridership") + theme_bw()
```
To understand the reason for the decline in ridership, we took a close look at subway service.  Information from the MTA web site showed that the number of actual subway trains in service almost matched the number of scheduled subway trains.  This can be seen by the nearly perfect line formed by plotting the number of scheduled trains to the number of actual trains.

&nbsp;
```{r, subway trains, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## retrieve train totals data
subway_trains <- read_csv("https://github.com/jessicapadilla/mta-mismanagement/raw/master/subway_service_delivered.csv")

## check the structure of the table
str(subway_trains)

## remove unwanted columns and rename some columns
subway_trains <- subway_trains %>% select(-division) %>%
  rename(scheduled_trains = "num_sched_trains", actual_trains = "num_actual_trains",
         ratio_scheduled_to_actual_trains = "service delivered")

## add a year column with the values from the month column
subway_trains <- subway_trains %>% mutate(year = month)

## edit the year column by removing the month and change the year to numbers
subway_trains$year <- subway_trains$year %>% 
  str_replace("^(\\d{4})-(\\d{2})$", "\\1") %>% as.numeric()

## check the subway totals table
head(subway_trains)

## create a graph showing the total number of trains each year
## exclude year 2019 since the year is not yet completed
subway_trains %>% filter(year <= 2018) %>% 
  mutate(year = factor(year)) %>% 
  ggplot(aes(scheduled_trains, actual_trains, col = line)) + 
  geom_point(size = 2) + facet_grid(. ~ year) +
  scale_color_discrete(name = "Subway Line") + xlim(0, 4000) + ylim(0, 4000) +
  xlab("Scheduled Number of Trains") + ylab("Actual Number of Trains") +
  ggtitle("Total Number of Subways") + theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
However, when we checked subway performance, we found several issues.  Although there has been an improvement in the number of track incidents, there have been no significant improvements in signal and subway car issues.  There has also been an increase in the number of issues related to subway stations and other infrastructure.

&nbsp;
```{r, subway incidents, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## retrieve subway incidents data
subway_incidents <- read_csv("https://github.com/jessicapadilla/mta-mismanagement/raw/master/subway_major_incidents.csv")

## check the structure of the subway incidents table
str(subway_incidents)

## remove the division column and rename the category column
subway_incidents <- subway_incidents %>% select(-division) %>% 
  rename(type_of_issue = category)

## add a year column using the values from the month column
subway_incidents <- subway_incidents %>% mutate(year = month)

## edit the year column by removing the month and change the year to numbers
subway_incidents$year <- subway_incidents$year %>% 
  str_replace("^(\\d{4})-(\\d{2})$", "\\1") %>% as.numeric()

## check the different types of issues
unique(subway_incidents$type_of_issue)

## make the persons on trackbed/police/medical text shorter
subway_incidents$type_of_issue <- subway_incidents$type_of_issue %>%
  str_replace("Persons on Trackbed/Police/Medical", "Passenger")

## reorder the types of issue
subway_incidents$type_of_issue <- factor(subway_incidents$type_of_issue, 
                                         levels = c("Signals", "Stations and Structure", 
                                                    "Subway Car", "Track", 
                                                    "Passenger", "Other"))

## check the subway incidents table
head(subway_incidents)

## create a graph showing the number of subway-related incidents per year
## exclude 2019 since the year is not yet completed
subway_incidents %>% 
  filter(year <= 2018 & type_of_issue %in% c("Signals", "Stations and Structure", "Subway Car", "Track")) %>%
  group_by(year, type_of_issue) %>%
  summarize(total_count = sum(count)) %>%
  ggplot(aes(year, total_count)) + 
  geom_bar(stat = "identity", fill = "black") + 
  coord_cartesian(ylim = c(0, 300)) +
  facet_wrap(.~type_of_issue, ncol = 2) +
  xlab("Year") + ylab("Total Number of Incidents") +
  ggtitle("Subway Incidents") + theme_bw()
```
Since the number of signal issues has not improved, train delays have also been prevalent over the years.  The amount of time passengers wait for a train and wait while they are on the train has remained at approximately 1 minute and 1.5 minute respectively.

&nbsp;
```{r, additional subway times, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## retrieve subway platform times data
subway_platform_times <- read_csv("https://github.com/jessicapadilla/mta-mismanagement/raw/master/subway_platform_time.csv")

## check the structure of the subway platform table
str(subway_platform_times)

## remove the division column and rename some columns
subway_platform_times <- subway_platform_times %>% select(-"division") %>% 
  rename(total_passengers = "num_passengers", 
         additional_platform_time = "additional platform time")

## add a year column by adding values from the month column
subway_platform_times <- subway_platform_times %>% mutate(year = month)

## edit the year column by removing the month and change the year to numbers
subway_platform_times$year <- subway_platform_times$year %>% 
  str_replace("^(\\d{4})-(\\d{2})$", "\\1") %>% as.numeric()

## check the subway platform table
head(subway_platform_times)

## create a graph for additional platform times
## exclude 2019 since the year is not yet completed
add_platform <- subway_platform_times %>% filter(year <= 2018) %>% group_by(year) %>%
  summarize(average_additional_platform = mean(additional_platform_time)) %>%
  ggplot(aes(year, average_additional_platform)) +
  geom_point(color = "purple") + geom_line(color = "purple") +
  coord_cartesian(ylim = c(0, 2.0)) +
  xlab("Year") + ylab("Minutes") + ggtitle("Average Additional Platform Time") +
  theme_bw()

## retrieve subway train times data
subway_train_times <- read_csv("https://github.com/jessicapadilla/mta-mismanagement/raw/master/subway_train_time.csv")

## check the structure of the subway train times table
str(subway_train_times)

## remvoe the divison column and rename some columns
subway_train_times <- subway_train_times %>% select(-"division") %>% 
  rename(total_passengers = "num_passengers", 
         additional_train_time = "additional train time")

## add a year column using the values from the month column
subway_train_times <- subway_train_times %>% mutate(year = month)

## edit the year column by removing the month and change the year to numbers
subway_train_times$year <- subway_train_times$year %>% 
  str_replace("^(\\d{4})-(\\d{2})$", "\\1") %>% as.numeric()

## check the subway train times table
head(subway_train_times)

## create a graph for additional train times
## exclude 2019 since the year is not yet completed
add_train <- subway_train_times %>% filter(year <= 2018) %>% group_by(year) %>%
  summarize(average_additional_train = mean(additional_train_time)) %>%
  ggplot(aes(year, average_additional_train)) +
  geom_point(color = "purple") + geom_line(color = "purple") +
  coord_cartesian(ylim = c(0, 2.0)) +
  xlab("Year") + ylab("Minutes") + ggtitle("Average Additional Train Time") +
  theme_bw()

## put the additional time graphs side by side
grid.arrange(add_platform, add_train, ncol = 1)
```
Citi Bikes were, then, introduced in NYC in 2013.  They allowed people to pay in per 30-minute ride, daily, or yearly.   Citi Bikes provided convenience and easily appealed to commuters since its annual membership for unlimited rides ($169) is cheaper than the unlimited Metrocard subway pass for a year ($1524).  Despite a decrease in usage in 2014, the number of daily Citi Bike trips has grown ever since then.  

&nbsp;
```{r,  daily citi bike totals, echo = FALSE, message = FALSE, results = 'hide', fig.height = 3.75}

## get the Citi Bikes Q3 2013 data
citi_q32013 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_launch_to_sep2013.csv")

## select the columns that are needed from the data
citi_q32013 <- citi_q32013 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members`)

## get the Citi Bikes Q4 2013 data
citi_q42013 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2013_to_dec2013.csv")

## select the columns that are needed from the data
citi_q42013 <- citi_q42013 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members`)

## get the Citi Bikes Q1 2014 data
citi_q12014 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jan2014_to_mar2014.csv")

## select the columns that are needed from the data
citi_q12014 <- citi_q12014 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members`)

## get the Citi Bikes Q2 2014 data
citi_q22014 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_apr2014_to_jun2014.csv")

## select the columns that are needed from the data
citi_q22014 <- citi_q22014 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Memberships Sold`) %>%
  rename(`Total Annual Members` = `Total Annual Memberships Sold`)

## get the Citi Bikes Q3 2014 data
citi_q32014 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jul2014_to_sep2014.csv")

## select the columns that are needed from the data
citi_q32014 <- citi_q32014 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Memberships Sold`) %>%
  rename(`Total Annual Members` = `Total Annual Memberships Sold`)

## get the Citi Bikes Q4 2014 data
citi_q42014 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2014_to_dec2014.csv")

## select the columns that are needed from the data
citi_q42014 <- citi_q42014 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Memberships Sold`) %>%
  rename(`Total Annual Members` = `Total Annual Memberships Sold`)

## get the Citi Bikes Q1 2015 data
citi_q12015 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jan2015_to_mar2015.csv")

## select the columns that are needed from the data
citi_q12015 <- citi_q12015 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>%
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q2 2015 data
citi_q22015 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_apr2015_to_jun2015.csv")

## select the columns that are needed from the data
citi_q22015 <- citi_q22015 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Memberships Sold`) %>% 
  rename(`Total Annual Members` = `Total Annual Memberships Sold`)

## get the Citi Bikes Q3 2015 data
citi_q32015 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jul2015_to_sep2015.csv")

## select the columns that are needed from the data
citi_q32015 <- citi_q32015 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Memberships Sold`) %>% 
  rename(`Total Annual Members` = `Total Annual Memberships Sold`)

## get the Citi Bikes Q4 2015 data
citi_q42015 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2015_to_dec2015.csv")

## select the columns that are needed from the data
citi_q42015 <- citi_q42015 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q1 2016 data
citi_q12016 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jan2016_to_mar2016.csv")

## select the columns that are needed from the data
citi_q12016 <- citi_q12016 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q2 2016 data
citi_q22016 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_apr2016_to_jun2016.csv")

## select the columns that are needed from the data
citi_q22016 <- citi_q22016 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q3 2016 data
citi_q32016 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jul2016_to_sep2016.csv")

## select the columns that are needed from the data
citi_q32016 <- citi_q32016 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q4 2016 data
citi_q42016 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2016_to_dec2016.csv")

## select the columns that are needed from the data
citi_q42016 <- citi_q42016 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q1 2017 data
citi_q12017 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jan2017_to_mar2017.csv")

## select the columns that are needed from the data
citi_q12017 <- citi_q12017 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q2 2017 data
citi_q22017 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_apr2017_to_jun2017.csv")

## select the columns that are needed from the data
citi_q22017 <- citi_q22017 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q3 2017 data
citi_q32017 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jul2017_to_sep2017.csv")

## select the columns that are needed from the data
citi_q32017 <- citi_q32017 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q4 2017 data
citi_q42017 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2017_to_dec2017.csv")

## select the columns that are needed from the data
citi_q42017 <- citi_q42017 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q1 2018 data
citi_q12018 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jan2018_to_mar2018.csv")

## select the columns that are needed from the data
citi_q12018 <- citi_q12018 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q2 2018 data
citi_q22018 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_apr2018_to_jun2018.csv")

## select the columns that are needed from the data
citi_q22018 <- citi_q22018 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q3 2018 data
citi_q32018 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_jul2018_to_sep2018.csv")

## select the columns that are needed from the data
citi_q32018 <- citi_q32018 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## get the Citi Bikes Q4 2018 data
citi_q42018 <- read_csv("https://github.com/jessicapadilla/mta_citi_uber/raw/master/citi_oct2018_to_dec2018.csv")

## select the columns that are needed from the data
citi_q42018 <- citi_q42018 %>% select(Date, `Trips over the past 24-hours (midnight to 11:59pm)`, `Total Annual Members (All Time)`) %>% 
  rename(`Total Annual Members` = `Total Annual Members (All Time)`)

## combine all the citi data
citi_riders <- rbind(citi_q32013, citi_q42013, 
                     citi_q12014, citi_q22014, citi_q32014, citi_q42014,
                     citi_q12015, citi_q22015, citi_q32015, citi_q42015,
                     citi_q12016, citi_q22016, citi_q32016, citi_q42016,
                     citi_q12017, citi_q22017, citi_q32017, citi_q42017,
                     citi_q12018, citi_q22018, citi_q32018, citi_q42018)

## check the citi data
head(citi_riders)

## rename the columns
citi_riders <- citi_riders %>% 
  rename(date = Date, total_citi_trips = `Trips over the past 24-hours (midnight to 11:59pm)`, 
         citi_annual_to_date = `Total Annual Members`)

## convert the date column to dates
citi_riders$date <- mdy(citi_riders$date)

## add a year column using the values from the date column
citi_riders <- citi_riders %>% mutate(year = date)

## edit the year column by removing the rest of the date and change the year to numbers
citi_riders$year <- citi_riders$year %>% 
  str_replace("^(\\d{4})-(\\d{2})-(\\d{2})$", "\\1") %>% as.numeric()

## add a month column using the values from the date column
citi_riders <- citi_riders %>% mutate(month = date)

## edit the year column by removing the rest of the date and change the year to numbers
citi_riders$month <- citi_riders$month %>% 
  str_replace("^(\\d{4})-(\\d{2})-(\\d{2})$", "\\2") %>% as.numeric()

## create a graph showing the number of citi bike trips
citi_riders %>% ggplot(aes(year, total_citi_trips)) + 
  geom_jitter(color = "purple", alpha = 0.3, size = 3, width = 0.3) + 
  scale_x_continuous(breaks = seq(2013, 2018, 1)) + 
  xlab("Year") + ylab("Number of Daily Trips") +
  ggtitle("Citi Bike Trips") +
  theme_bw()
```

